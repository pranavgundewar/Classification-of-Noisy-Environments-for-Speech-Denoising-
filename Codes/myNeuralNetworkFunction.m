function [y1] = myNeuralNetworkFunction(x1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-Apr-2017 19:24:30.
%
% [y1] = myNeuralNetworkFunction(x1) takes these arguments:
%   x = Qx13 matrix, input #1
% and returns:
%   y = Qx5 matrix, output #1
% where Q is the number of samples.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step1.gain = [0.136986886859857;1.95389107437732;2.95420059890959;3.9555071841799;4.78610124379114;4.64470226179174;4.53308743875226;4.31437107751056;5.17150429867463;4.95215244569411;4.95215244569411;5.17150429867463;4.31437107751056];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.8996684601663822;2.0315774196111471;0.1350073271085879;0.088137797490085532;0.95311593743308987;7.1291882506299711;-5.151241588639393;6.4792379733765593;-1.0802525655759387;-0.39521125569774535];
IW1_1 = [0.096907123532768993 -0.62245717698550107 -2.1538026238383954 -0.96635765616125779 -0.17382206976411482 -0.81559554537881251 -0.41122878841351784 -0.1191873302821724 0.084693877761110162 -0.71708924876701552 -0.33686223237683199 -0.37216636136055653 -0.11038599139581358;4.129407099920174 -2.7576855499442745 -0.91506026965174014 0.35492134866205372 0.82905536153818249 0.72855498169412014 0.11290812991464584 0.29256820610901896 -0.0053859855236358806 -0.07701427113404298 0.45456922383582837 0.29026403904532944 0.42401992981895625;2.143892375336395 1.5435754878379475 -2.0699724379370754 -1.6506127771777261 1.1282447610088358 0.74848727498499446 -0.039050448140475924 0.43867529746024547 0.63505921868413728 -0.33847335565275505 0.54780202986268223 -0.27093995722294756 -0.091513978478713731;0.01362504650738598 -0.059900182501848573 -2.531887199586075 0.0047290968017394772 -0.68215925494915564 -0.34114283108075 0.12056347417919583 0.92266627920656941 0.59421831435414862 0.15859516704979637 0.24708952742756451 0.76616217192260971 0.12275580829811343;6.1319343186987956 -1.6020672394201811 0.088712015649807199 -0.25775287709468225 -0.36823653692020669 -0.28044610777806767 0.42928360882890515 0.10673626295836512 -0.046736963842332453 0.61212160575040309 -0.41467697004507964 0.44004635248620655 -0.013233718544217255;12.431794341190379 -0.55027992055671715 -0.59270643110747301 -0.255678598612189 0.17184155832202336 0.0093653898280741249 -0.035693347566560799 -0.26882737527016809 -0.41371543335204441 -0.048562037178468812 0.03037246509934349 0.45888518478119855 0.30380667415113555;-6.5507948517730341 -1.5290508777460696 -0.42143684578564811 -0.92971371247791412 -0.31288602187139319 -0.15337070149957516 0.16329707564186946 -0.3342844498852684 0.51787160756887718 -0.16638547760161082 0.17974230227280882 -0.54969246540346861 -0.036258345234481411;12.269727598638276 0.33413013927685725 0.46510893509202172 0.33308256093756466 0.0027583756175538561 0.17777812902342677 0.077753528692075274 -0.52058366723430338 -0.20508659892628828 0.17190671330415769 -0.27665630435090194 0.089100670683952624 0.54676725244153579;-4.475044785964208 -1.0167131155569944 -0.95365815287682099 0.16831399724978061 -0.19988939346538648 0.49909517867865871 -0.53779070785830041 0.52091001873101928 0.39136946181648008 -0.52219625801837877 0.873304981800193 -0.099658498555016767 0.11464835039377544;1.1818529957741508 1.0442326755187994 -0.54074003157053518 2.1486278034251534 -2.3178831736202992 1.1507579306800877 -0.25348944379154725 -0.0088720114217983453 -0.14618503342778211 0.3435576521618679 -0.55419126404305696 0.56273212073375978 -0.10628675206534884];

% Layer 2
b2 = [-1.190778438839015;3.817484422411213;-0.3318530762521969;-0.61413381325148664;-0.14960477087971069];
LW2_1 = [-0.57883943794531934 -3.3940777725178268 2.273015036213061 1.1817863939659961 3.915145934520635 10.637850097484458 -1.1965587527550428 -3.5192999095563775 0.89760804088827362 1.6076853842784029;-0.11352905090460921 -0.91270560295960368 0.9755228707180964 -1.9357468654773047 -0.49229214795873205 1.8464723533960963 -0.62692620699113977 -7.2005442995715061 -4.8170082740684013 0.58470691729491242;0.60588477896437409 3.5790021689454514 1.7577353325576242 -1.0551641359834811 -3.0738299881592877 5.5323544676234579 3.1841503603850612 -1.5116331562674858 -1.1417235056043822 2.4357397348074756;-1.3950614578220402 4.1367978981014097 -3.0922801327725939 2.3677232697075219 -4.3894468313057367 -9.6241814445039982 3.9386335408151347 9.021371692385781 2.8185339200376984 -2.0335032089232588;2.2504988291203185 -2.8653238833530561 -1.7024526749583089 -0.91938581309372136 4.175850610512275 -6.8400761587862968 -5.6721124870408595 2.6834099712477153 5.7532457361892986 -1.881314046917365];

% ===== SIMULATION ========

% Dimensions
Q = size(x1,1); % samples

% Input 1
x1 = x1';
xp1 = mapminmax_apply(x1,x1_step1);

% Layer 1
a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*xp1);

% Layer 2
a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);

% Output 1
y1 = a2;
y1 = y1';
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n,~)
if isa(n,'gpuArray')
    a = iSoftmaxApplyGPU(n);
else
    a = iSoftmaxApplyCPU(n);
end
end
function a = iSoftmaxApplyCPU(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numerator = exp(n);
denominator = sum(numerator,1);
denominator(denominator == 0) = 1;
a = bsxfun(@rdivide,numerator,denominator);
end
function a = iSoftmaxApplyGPU(n)
nmax = max(n,[],1);
numerator = arrayfun(@iSoftmaxApplyGPUHelper1,n,nmax);
denominator = sum(numerator,1);
a = arrayfun(@iSoftmaxApplyGPUHelper2,numerator,denominator);
end
function numerator = iSoftmaxApplyGPUHelper1(n,nmax)
numerator = exp(n - nmax);
end
function a = iSoftmaxApplyGPUHelper2(numerator,denominator)
if (denominator == 0)
    a = numerator;
else
    a = numerator ./ denominator;
end
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
